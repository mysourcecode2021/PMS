@{
    ViewData["Title"] = "Report";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Report To Bank</h3>
        <div class="card-tools col-md-10">
            <div class="input-group">
                <input type="text" class="form-control dpMonth" id="Periode" />
                <div class="input-group-append">
                    <button class="btn btn-secondary btn-sm" type="button" id="btnExport">
                        <i class="fas fa-file-export">
                        </i>
                        Export Data
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="row table-responsive" id="_content">
        </div>
    </div>
</div>

<script>
    $(function () {
        $("#btnExport").click(function () {
            var param = {};
            param["Periode"] = $("#Periode").val();

            $.ajax({
                type: "POST",
                url: "/ReportToBank/ExportExcel",
                data: JSON.stringify(param),
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.btn').prop('disabled', true);
                },
                complete: function () {
                    $('.btn').prop('disabled', false);
                },
                success: function (result) {
                    var bytes = base64ToBytes(result);
                    var blob = new Blob([bytes], { type: "application/octetstream" });

                    var date = new Date();
                    var dateStr =
                        ("00" + (date.getMonth() + 1)).slice(-2) +
                        ("00" + date.getDate()).slice(-2) +
                        date.getFullYear() +
                        ("00" + date.getHours()).slice(-2) +
                        ("00" + date.getMinutes()).slice(-2) +
                        ("00" + date.getSeconds()).slice(-2);
                    var filename = "Data_" + dateStr + ".xlsx";

                    var isIE = false || !!document.documentMode;
                    if (isIE) {
                        window.navigator.msSaveBlob(blob, filename);
                    } else {
                        var url = window.URL || window.webkitURL;
                        var link = url.createObjectURL(blob);
                        var a = $("<a />");
                        a.attr("download", filename);
                        a.attr("href", link);
                        $("body").append(a);
                        a[0].click();
                        $("body").remove(a);
                    }
                },
                error: function (result) {
                    toastr.error(result.responseText);
                }
            });
        });
    });

    base64ToBytes = function (base64) {
        var binary_string = window.atob(base64);
        var len = binary_string.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes.buffer;
    }
</script>