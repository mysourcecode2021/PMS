
@{
    ViewData["Title"] = "BPJSHealth";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">BPJSHealth</h3>
        <div class="card-tools col-md-10">
            <div class="input-group">
                <input type="text" class="form-control dpMonth" id="PeriodeFilter" />
                @*<select class="custom-select" id="PeriodeYear">
                    <option value="">--Year--</option>
                    @foreach (var r in (List<dynamic>)ViewData["YEAR"]!)
                    {
                        <option value="@r.SystemCode">@r.SystemValue</option>
                    }
                </select>
                <select class="custom-select" id="PeriodeMonth">
                    <option value="">--Month--</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="08">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>*@
                <div class="input-group-append">
                    &nbsp;
                    <button class="btn btn-outline-primary" type="button" id="btnGenerate">Generate BPJS</button>
                    &nbsp;
                    <a class="btn btn-primary btn-sm" id="btnSearch" href="javascript:void(0)">
                        <i class="fas fa-search">
                        </i>
                        Search
                    </a>
                    &nbsp;
                    <a class="btn btn-danger btn-sm" id="btnClear" href="javascript:void(0)">
                        <i class="fas fa-eraser">
                        </i>
                        Clear
                    </a>
                    &nbsp;
                    <a class="btn btn-primary btn-sm" id="btnAdd" href="javascript:void(0)">
                        <i class="fas fa-plus">
                        </i>
                        Add
                    </a>
                    &nbsp;
                    <a class="btn btn-warning btn-sm" id="btnEdit" href="javascript:void(0)">
                        <i class="fas fa-pencil-alt">
                        </i>
                        Edit
                    </a>
                    &nbsp;
                    <a class="btn btn-danger btn-sm" id="btnDelete" href="javascript:void(0)">
                        <i class="fas fa-trash">
                        </i>
                        Delete
                    </a>
                    &nbsp;
                    <a class="btn btn-secondary btn-sm" id="btnExport" href="javascript:void(0)">
                        <i class="fas fa-file-export">
                        </i>
                        Export Data
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="row table-responsive" id="_content">

        </div>
    </div>
</div>

<div class="modal fade" id="_modal-form" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Form BPJS Health</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="_formId">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>NIK<font color='red'>*</font></label>
                                    <select name="NIK" data-name="NIK" class="form-control select2bs4 _formInput mandatory isKey" placeholder="NIK" onchange="getSalary()">
                                        <option value="">--NIK--</option>
                                        @foreach (var r in (List<dynamic>)ViewData["NIKName"]!)
                                        {
                                            <option value="@r.NIK">@r.NIK - @r.Name</option>
                                        }
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Periode<font color='red'>*</font></label>
                                    <input type="text" name="Periode" data-name="Periode" class="form-control dpMonth _formInput mandatory isKey" placeholder="Periode" />
                                </div>
                                <div class="form-group">
                                    <label>No BPJS<font color='red'>*</font></label>
                                    <input type="text" name="NoBPJS" data-name="NoBPJS" class="form-control _formInput mandatory" placeholder="No BPJS" />
                                </div>
                                <div class="form-group">
                                    <label>Class<font color='red'>*</font></label>
                                    <input type="text" name="Class" data-name="Class" class="form-control _formInput mandatory" placeholder="Class" />
                                </div>
                                <div class="form-group">
                                    <label>Basic Salary<font color='red'>*</font></label>
                                    <input type="text" name="BasicSalary" data-name="BasicSalary" class="form-control _formInput mandatory isDisabled" placeholder="Basic Salary" disabled />
                                </div>
                                <div class="form-group">
                                    <label>Fix Allowance<font color='red'>*</font></label>
                                    <input type="text" name="FixAllowance" data-name="FixAllowance" class="form-control _formInput mandatory isDisabled" placeholder="FixAllowance" disabled />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Salary<font color='red'>*</font></label>
                                    <input type="text" name="Salary" data-name="Salary" class="form-control _formInput mandatory isDisabled" placeholder="Salary" disabled />
                                </div>
                                <div class="form-group">
                                    <label>Base Calculation<font color='red'>*</font></label>
                                    <input type="text" name="BaseCalculation" data-name="BaseCalculation" class="form-control _formInput mandatory isDisabled" placeholder="Base Calculation" disabled />
                                </div>
                                <div class="form-group">
                                    <label>Iuran Company<font color='red'>*</font></label>
                                    <input type="text" name="IuranCompany" data-name="IuranCompany" class="form-control _formInput mandatory isDisabled" placeholder="Iuran Company" disabled />
                                </div>
                                <div class="form-group">
                                    <label>Iuran Employee<font color='red'>*</font></label>
                                    <input type="text" name="IuranEmployee" data-name="IuranEmployee" class="form-control _formInput mandatory isDisabled" placeholder="Iuran Employee" disabled />
                                </div>
                                <div class="form-group">
                                    <label>Iuran BPJS<font color='red'>*</font></label>
                                    <input type="text" name="IuranBPJS" data-name="IuranBPJS" class="form-control _formInput mandatory isDisabled" placeholder="Iuran BPJS" disabled />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <input type="hidden" data-name="Action" class="_formInput" />
                        <button type="submit" class="btn btn-primary" id="btnSave">Save</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="_modal-detail" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">BPJS Health Detail</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <div class="form-group">
                        <label>NIK : </label>
                        <label id="lblNIK"></label>
                    </div>
                    <div class="form-group">
                        <label>Name : </label>
                        <label id="lblName"></label>
                    </div>

                    <table id="_gridBPJS" class="table table-head-fixed text-nowrap table-striped">
                        <thead>
                            <tr>
                                <td><input type="text" class="form-control" name="FName" /></td>
                                <td><input type="text" class="form-control" name="FNoBPJS" /></td>
                                <td>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                            </div>
                                            <input type="text" name="FDOB" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="mm/dd/yyyy" data-mask>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control" name="FStatus">
                                        <option value="">--Status--</option>
                                        <option value="Employee">Employee</option>
                                        <option value="Wife/Husband">Wife/Husband</option>
                                        <option value="Child">Child</option>
                                    </select>
                                </td>
                                <td><button type="button" class="btn btn-primary" id="btnSaveDetail">Save</button></td>
                            </tr>
                            <tr>
                                <th>Name</th>
                                <th>No BPJS</th>
                                <th>Date Of Birth</th>
                                <th>Status</th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('[name="FDOB"]').inputmask('mm/dd/yyyy', { 'placeholder': 'mm/dd/yyyy' });
        $(".select2bs4").select2({
	        theme: 'bootstrap4'
        });

        getData(1, "Clear");

        $(document).on('click', '#checkAll', function (e) {
            if (this.checked) {
                $(".checkboxes").prop("checked", true);
            } else {
                $(".checkboxes").prop("checked", false);
            }
        });

        $("#btnSearch").click(function () {
            getData(1);
        });

        $("#btnClear").click(function () {
            $("._searchCriteria").val("");
            $("#PeriodeFilter").val("");
            getData(1, "Clear");
        });

        $("#btnAdd").click(function () {
            $("._formInput").val("");
            $('select').val("").trigger('change');
            $(".isKey").prop("disabled", false);
            $(".isDisabled").prop("disabled", true);
            $("[data-name='Action']").val("Add");
            $("#_modal-form").modal("show");
        });

        $("#btnEdit").click(function () {
            var key1 = "";
            var key2 = "";
            $("#_grid tbody input[type=checkbox]:checked").each(function () {
                key1 += ";" + $(this).attr("data-key").split("|")[0];
                key2 += ";" + $(this).attr("data-key").split("|")[1];
            });
            key1 = (key1 != "") ? (";" + key1).replace(";;", "") : key1;
            key2 = (key2 != "") ? (";" + key2).replace(";;", "") : key2;
            if (key1 == "") {
                toastr.error("Data has not been selected");
                return;
            }
            if (key1.split(";").length > 1) {
                toastr.error("Only one data can be selected");
                return;
            }

            var param = {};
            param["Param"] = key1 + "|" + key2;
            param["Type"] = "GetByKey";

            $.ajax({
                type: "POST",
                url: "/BPJSHealth/GetDataByKey",
                data: JSON.stringify(param),
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.btn').prop('disabled', true);
                },
                complete: function () {
                    $('.btn').prop('disabled', false);
                },
                success: function (result) {
                    var row = result[0];

                    $("._formInput").each(function (i, obj) {
                        if ($(obj).attr("class").indexOf("isKey") > 0) {
                            $(obj).prop("disabled", "true");
                        }
                        
                        if ($(obj).is("select")) {
	                        $('[name="' + $(obj).attr("name") + '"]').val(row[$(obj).attr("data-name")]).trigger('change');
                        } else {
	                        $(obj).val(row[$(obj).attr("data-name")]);
                        }
                    });
                    $("[data-name='Action']").val("Edit");
                    $("#_modal-form").modal("show");
                },
                error: function (result) {
                    toastr.error(result.responseText);
                }
            });
        });

        $("#btnDelete").click(function () {
            var key1 = "";
            var key2 = "";
            $("#_grid tbody input[type=checkbox]:checked").each(function () {
                key1 += ";" + $(this).attr("data-key").split("|")[0];
                key2 += ";" + $(this).attr("data-key").split("|")[1];
            });
            key1 = (key1 != "") ? (";" + key1).replace(";;", "") : key1;
            key2 = (key2 != "") ? (";" + key2).replace(";;", "") : key2;
            if (key1 == "") {
                toastr.error("Data has not been selected");
                return;
            }
            
            Swal.fire({
                title: "Are you sure?",
                text: "This data will be deleted!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, do it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    var param = {};
                    param["KeyValue"] = key1 + "|" + key2
                    param["Action"] = "Delete";

                    $.ajax({
                        type: "POST",
                        url: "/BPJSHealth/SaveProcess",
                        data: JSON.stringify(param),
                        contentType: "application/json; charset=utf-8",
                        beforeSend: function () {
                            $('.btn').prop('disabled', true);
                        },
                        complete: function () {
                            $('.btn').prop('disabled', false);
                        },
                        success: function (result) {
                            if (result == "Success") {
                                toastr.success("Data has been processed successfully");
                                getData(1);
                            } else {
                                toastr.error(result);
                            }
                        },
                        error: function (result) {
                            toastr.error(result.responseText);
                        }
                    });
                }
            });
        });

        $("#btnExport").click(function() {
            var param = {};
            var pValue = "";
            $("._searchCriteria").each(function (i, obj) {
                pValue += this.value + ";";
            });
            param["Param"] = pValue;
            param["ParamHeader"] = $("#PeriodeFilter").val();
            param["Type"] = "Export";
            
            $.ajax({
                type: "POST",
                url: "/BPJSHealth/ExportExcel",
                data: JSON.stringify(param),
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.btn').prop('disabled', true);
                },
                complete: function () {
                    $('.btn').prop('disabled', false);
                },
                success: function (result) {
                    var bytes = base64ToBytes(result);
                    var blob = new Blob([bytes], { type: "application/octetstream" });

                    var date = new Date();
                    var dateStr =
                        ("00" + (date.getMonth() + 1)).slice(-2) +
                        ("00" + date.getDate()).slice(-2) +
                        date.getFullYear() +
                        ("00" + date.getHours()).slice(-2) +
                        ("00" + date.getMinutes()).slice(-2) +
                        ("00" + date.getSeconds()).slice(-2);
                    var filename = "Data_" + dateStr + ".xlsx";

                    var isIE = false || !!document.documentMode;
                    if (isIE) {
                        window.navigator.msSaveBlob(blob, filename);
                    } else {
                        var url = window.URL || window.webkitURL;
                        var link = url.createObjectURL(blob);
                        var a = $("<a />");
                        a.attr("download", filename);
                        a.attr("href", link);
                        $("body").append(a);
                        a[0].click();
                        $("body").remove(a);
                    }
                },
                error: function (result) {
                    toastr.error(result.responseText);
                }
            });
        });

        $("#btnSave").click(function() {
            var isRules = {};
            var isMessages = {};
            $("._formInput").each(function (i, obj) {
                if ($(obj).attr("class").toLowerCase().indexOf("mandatory") > 0) {
                    isRules[$(obj).attr("data-name")] = { required: true };
                    isMessages[$(obj).attr("data-name")] = { required: "Please enter a " + $(obj).attr("placeholder") };
                }
            });

            $("#_formId").validate({
                rules: isRules,
                messages: isMessages,
                errorElement: 'span',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.form-group').append(error);
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                },
                submitHandler: function (res) {
                    onSaveProcess();
                }
            });
        });

        $(document).on('click', '#btnDetail', function (e) {
            $("#lblNIK").text($(this).attr("data-value").split("|")[0]);
            $("#lblName").text($(this).attr("data-value").split("|")[1]);
            getDataDetail();
            $("#_modal-detail").modal("show");
        });

        $("#btnSaveDetail").click(function () {
            var param = {
                NIK: $("#lblNIK").text(),
                Name: $("[name='FName']").val(),
                NoBPJS: $("[name='FNoBPJS']").val(),
                DOB: $("[name='FDOB']").val(),
                Status: $("[name='FStatus']").val(),
            };
            
            Swal.fire({
                title: "Are you sure?",
                text: "This data will be processed!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, do it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: "/BPJSHealth/ProcessDetail",
                        data: JSON.stringify(param),
                        contentType: "application/json; charset=utf-8",
                        beforeSend: function () {
                            $('.btn').prop('disabled', true);
                        },
                        complete: function () {
                            $('.btn').prop('disabled', false);
                        },
                        success: function (result) {
                            if (result == "Success") {
                                toastr.success("Data has been processed successfully");
                                getDataDetail();
                            } else {
                                toastr.error(result);
                            }
                        },
                        error: function (result) {
                            toastr.error(result.responseText);
                        }
                    });
                }
            });
        });

        $("#btnGenerate").click(function() {
            if ($("#PeriodeFilter").val() == "") {
                toastr.error("Periode must be fill");
                return;
            }

            Swal.fire({
                title: "Are you sure?",
                text: "This data will be processed!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, do it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    var param = {};
                    param["Periode"] = $("#PeriodeFilter").val().toString();
                    param["Act"] = "Generate";

                    $.ajax({
                        type: "POST",
                        url: "/BPJSHealth/GenerateBPJS",
                        data: JSON.stringify(param),
                        contentType: "application/json; charset=utf-8",
                        beforeSend: function () {
                            $('.btn').prop('disabled', true);
                        },
                        complete: function () {
                            $('.btn').prop('disabled', false);
                        },
                        success: function (result) {
                            if (result == "Success") {
                                toastr.success("Data has been processed successfully");
                                getData(1);
                            } else {
                                if (result.indexOf("has been generated") > 0) {
                                    Swal.fire({
                                        title: "Are you sure to Re-Generate?",
                                        text: result,
                                        icon: "warning",
                                        showCancelButton: true,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: 'Yes, do it!'
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            param = {};
                                            param["Periode"] = $("#PeriodeFilter").val().toString();
                                            param["Act"] = "Re-Generate";

                                            $.ajax({
                                                type: "POST",
                                                url: "/BPJSHealth/GenerateBPJS",
                                                data: JSON.stringify(param),
                                                contentType: "application/json; charset=utf-8",
                                                beforeSend: function () {
                                                    $('.btn').prop('disabled', true);
                                                },
                                                complete: function () {
                                                    $('.btn').prop('disabled', false);
                                                },
                                                success: function (result) {
                                                    if (result == "Success") {
                                                        toastr.success("Data has been processed successfully");
                                                        getData(1);
                                                    } else {
                                                        toastr.error(result);
                                                    }
                                                },
                                                error: function (result) {
                                                    toastr.error(result.responseText);
                                                }
                                            });
                                        }
                                    });
                                }
                            }
                        },
                        error: function (result) {
                            toastr.error(result.responseText);
                        }
                    });
                }
            });
        });
    });

    getData = function (page = 1, act = "") {
        var param = {};
        var pValue = "";
        $("._searchCriteria").each(function (i, obj) {
            pValue += this.value + ";";
        });
        param["Param"] = (act == "Clear") ? "-1" : pValue;
        param["ParamHeader"] = $("#PeriodeFilter").val();
        param["PageNumber"] = page;
        param["RowsOfPage"] = ($(".pageSize").val() == undefined) ? 10 : $(".pageSize").val();

        $.ajax({
            type: "POST",
            url: "/BPJSHealth/GetData",
            data: JSON.stringify(param),
            contentType: "application/json; charset=utf-8",
            beforeSend: function () {
                $('.btn').prop('disabled', true);
            },
            complete: function () {
                $('.btn').prop('disabled', false);
            },
            success: function (result) {
                $("#_content").html(result);

                if (act == "") {
                    var parValue = param.Param.split(";");
                    var seq = 0;
                    $("._searchCriteria").each(function (i, obj) {
                        $(obj).val(parValue[seq]);
                        seq++;
                    });
                }
            },
            error: function (result) {
                toastr.error(result.responseText);
            }
        });
    }

    onSaveProcess = function () {
        Swal.fire({
            title: "Are you sure?",
            text: "This data will be processed!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, do it!'
        }).then((result) => {
            if (result.isConfirmed) {
                var param = {};
                $("._formInput").each(function (i, obj) {
                    param[$(obj).attr("data-name")] = this.value;
                });

                $.ajax({
                    type: "POST",
                    url: "/BPJSHealth/SaveProcess",
                    data: JSON.stringify(param),
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.btn').prop('disabled', true);
                    },
                    complete: function () {
                        $('.btn').prop('disabled', false);
                    },
                    success: function (result) {
                        if (result == "Success") {
                            toastr.success("Data has been processed successfully");
                            $("._formInput").val("");
                            $("._formInput").prop("disabled", false);
                            $("#_modal-form").modal("hide");
                            getData(1);
                        } else {
                            toastr.error(result);
                        }
                    },
                    error: function (result) {
                        toastr.error(result.responseText);
                    }
                });
            }
        });
    }

    base64ToBytes = function (base64) {
        var binary_string = window.atob(base64);
        var len = binary_string.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes.buffer;
    }

    searchFilter = function (e) {
        if (e.keyCode === 13) {
            getData(1);
        }
    }

    getSalary = function () {
        if ($("[name='NIK']").val() != "") {
            var param = {};
            param["Param"] = $("[name='NIK']").val();
            param["Type"] = "GetSalaryByNIK";

            $.ajax({
                type: "POST",
                url: "/BPJSHealth/GetDataByKey",
                data: JSON.stringify(param),
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.btn').prop('disabled', true);
                },
                complete: function () {
                    $('.btn').prop('disabled', false);
                },
                success: function (result) {
                    if (result.length > 0) {
                        for (var x = 0; x < result.length; x++) {
                            if (result[x].Component == "Basic Salary") {
                                $("[name='BasicSalary']").val(result[x].Amount);
                            } else if (result[x].Component == "Position Allowance") {
                                $("[name='FixAllowance']").val(result[x].Amount);
                            }
                        }

                        $("[name='Salary']").val(parseFloat($("[name='BasicSalary']").val()) + parseFloat($("[name='FixAllowance']").val()));
                        $("[name='BaseCalculation']").val((parseFloat($("[name='Salary']").val()) > parseFloat("@ViewBag.BaseCalculation")) ? "@ViewBag.BaseCalculation" : $("[name='Salary']").val());
                        if (parseFloat($("[name='Salary']").val()) < parseFloat("@ViewBag.BaseCalculation")) {
                            $("[name='IuranCompany']").val(((parseFloat("@ViewBag.IuranCompany") / 100) * parseFloat($("[name='Salary']").val())).toFixed(2));
                            $("[name='IuranEmployee']").val(((parseFloat("@ViewBag.IuranEmployee") / 100) * parseFloat($("[name='Salary']").val())).toFixed(2));
                        } else {
                            $("[name='IuranCompany']").val(((parseFloat("@ViewBag.IuranCompany") / 100) * parseFloat("@ViewBag.BaseCalculation")).toFixed(2));
                            $("[name='IuranEmployee']").val(((parseFloat("@ViewBag.IuranEmployee") / 100) * parseFloat("@ViewBag.BaseCalculation")).toFixed(2));
                        }
                        $("[name='IuranBPJS']").val((parseFloat($("[name='IuranCompany']").val()) + parseFloat($("[name='IuranEmployee']").val())).toFixed(2));
                    } else {
                        $("[name='NoBPJS']").val("");
                        $("[name='BasicSalary']").val("");
                        $("[name='FixAllowance']").val("");
                        $("[name='Salary']").val("");
                        $("[name='IuranCompany']").val("");
                        $("[name='IuranEmployee']").val("");
                        $("[name='Class']").val("");
                        $("[name='IuranBPJS']").val("");
                        $("[name='BaseCalculation']").val("");
                        toastr.error("NIK not found");
                    }
                },
                error: function (result) {
                    toastr.error(result.responseText);
                }
            });
        }
    }

    getDataDetail = function () {
        var param = {};
        param["Param"] = $("#lblNIK").text();
        param["Type"] = "GetDetailBPJSHealth";

        $.ajax({
            type: "POST",
            url: "/BPJSHealth/GetDataByKey",
            data: JSON.stringify(param),
            contentType: "application/json; charset=utf-8",
            beforeSend: function () {
                $('.btn').prop('disabled', true);
            },
            complete: function () {
                $('.btn').prop('disabled', false);
            },
            success: function (result) {
                $("[name='FName']").val("");
                $("[name='FNoBPJS']").val("");
                $("[name='FDOB']").val("");
                $("[name='FStatus']").val("");
                $("[name='FName']").prop("disabled", false);

                $("#_gridBPJS tbody").empty();
                var html = "";
                for (var x = 0; x < result.length; x++) {
                    var btnEdit = '<button type="button" class="btn btn-warning" onclick="setEditGrid(this)" data-value="' + result[x].Name + '|' + result[x].NoBPJS + '|' + result[x].DOB + '|' + result[x].Status + '">Edit</button>';
                    var btnDelete = '<button type="button" class="btn btn-warning" onclick="setDeletetGrid(this)" data-value="' + result[x].NoBPJS + '">Delete</button>';
                    html += "<tr><td>" + result[x].Name + "</td><td>" + result[x].NoBPJS + "</td><td>" + result[x].DOB + "</td><td>" + result[x].Status + "</td><td>" + btnEdit + " " + btnDelete + "</td></tr>";
                }
                $("#_gridBPJS tbody").append(html);
            },
            error: function (result) {
                toastr.error(result.responseText);
            }
        });
    }

    setEditGrid = function (obj) {
        $("[name='FName']").val($(obj).attr("data-value").split("|")[0]);
        $("[name='FNoBPJS']").val($(obj).attr("data-value").split("|")[1]);
        $("[name='FDOB']").val($(obj).attr("data-value").split("|")[2]);
        $("[name='FStatus']").val($(obj).attr("data-value").split("|")[3]);

        $("[name='FName']").prop("disabled", true);
    }

    setDeletetGrid = function (obj) {
        var param = {
            NIK: $("#lblNIK").text(),
            NoBPJS: $(obj).attr("data-value")
        };

        Swal.fire({
            title: "Are you sure?",
            text: "This data will be deleted!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, do it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    type: "POST",
                    url: "/BPJSHealth/DeleteProcessDetail",
                    data: JSON.stringify(param),
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.btn').prop('disabled', true);
                    },
                    complete: function () {
                        $('.btn').prop('disabled', false);
                    },
                    success: function (result) {
                        if (result == "Success") {
                            toastr.success("Data has been processed successfully");
                            getDataDetail();
                        } else {
                            toastr.error(result);
                        }
                    },
                    error: function (result) {
                        toastr.error(result.responseText);
                    }
                });
            }
        });
    }
</script>